<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>課表試排</title>
    <style>
        .months {
            margin-bottom: 50px;
        }

        .weeks {
            width: 1232px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
        }

        .days,
        .week-titles {
            min-width: 126px;
            min-height: 0px;
            padding: 15px;
            text-align: center;
            margin: 10px;
            background-color: #ccc;
        }

        .week-titles {
            background-color: #afa;
        }

        .holiday {
            background-color: #faf;
        }

        div[draggable="true"] {
            /*
   To prevent user selecting inside the drag source
  */
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>

<body>
    <label for="">前端班開課日期：</label>
    <input type="date" id="getMFEEDay">
    <div id="root"></div>
    <!-- <div class="month">
        <div class="month-title">11月</div>
        <div class="weeks">
            <div class="days">1</div>
            <div class="days">2</div>
        </div>

    </div> -->

    <script src="https://unpkg.com/dayjs"></script>
    <script src="https://unpkg.com/dayjs@1.8.21/plugin/isSameOrAfter"></script>
    <script>dayjs.extend(window.dayjs_plugin_isSameOrAfter)</script>
    <script>

        let getDay = document.querySelector("#getMFEEDay")
        getDay.value = '2021-02-24';

        getDay.addEventListener('change', () => {
            render();
            console.log('getDay.value', getDay.value);
        })

        // dayjs('2019-01-25').daysInMonth() 月份天數
        // dayjs(`2019-12-${i}`).day() 星期幾
        let root = document.querySelector('#root');
        let year = 2021;
        let month = 1;
        let weekIndex = 0;
        let dayIndex = 0;
        let newMonthDiv = null;
        let newWeekDiv = null;

        const holidays2021 = ['2021-1-1', '2021-1-2', '2021-1-3', '2021-2-10', '2021-2-11', '2021-2-12', '2021-2-13', '2021-2-14', '2021-2-15', '2021-2-16', '2021-2-27', '2021-2-28', , '2021-3-01', '2021-4-2', '2021-4-3', '2021-4-4', '2021-4-5', '2021-6-12', '2021-6-13', '2021-6-14', '2021-9-19', '2021-9-20', '2021-9-21', '2021-10-9', '2021-10-10', '2021-10-11'];

        const checkIfHoliday = (date) => {
            let isHoliday = false;
            holidays2021.forEach((holiday) => {
                if (dayjs(date).isSame(holiday) || dayjs(date).day() === 0 || dayjs(date).day() === 6) isHoliday = true;
            })

            return isHoliday;
        }

        const week1 = [['<div class="class-title" draggable="true">導師時間</div>', '<div class="class-title" draggable="true">開訓典禮</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網頁設計入門</div>', '<div class="class-title" draggable="true">網頁設計入門</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網頁設計入門</div>', '<div class="class-title" draggable="true">網頁設計入門</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網頁設計入門</div>', '<div class="class-title" draggable="true">網頁設計入門</div>', '<div class="class-title" draggable="true">N/A</div>']];

        const week2 = [['<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">網站規劃</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week3 = [['<div class="class-title" draggable="true">網站視覺設計</div>', '<div class="class-title" draggable="true">LAB1</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">CSS</div>', '<div class="class-title" draggable="true">CSS</div>', '<div class="class-title" draggable="true">LAB2</div>'], ['<div class="class-title" draggable="true">CSS</div>', '<div class="class-title" draggable="true">CSS</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">CSS</div>', '<div class="class-title" draggable="true">CSS</div>', '<div class="class-title" draggable="true">LAB3</div>'], ['<div class="class-title" draggable="true">Bootstrap</div>', '<div class="class-title" draggable="true">Bootstrap</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week4 = [['<div class="class-title" draggable="true">Bootstrap</div>', '<div class="class-title" draggable="true">Bootstrap</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">Bootstrap</div>', '<div class="class-title" draggable="true">Bootstrap</div>', '<div class="class-title" draggable="true">LAB4</div>'], ['<div class="class-title" draggable="true">UI設計實作</div>', '<div class="class-title" draggable="true">UI設計實作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">UI設計實作</div>', '<div class="class-title" draggable="true">UI設計實作</div>', '<div class="class-title" draggable="true">LAB5</div>'], ['<div class="class-title" draggable="true">專題觀摩</div>', '<div class="class-title" draggable="true">網站規劃</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week5 = [['<div class="class-title" draggable="true">UI設計實作</div>', '<div class="class-title" draggable="true">UI設計實作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">JS</div>', '<div class="class-title" draggable="true">JS</div>', '<div class="class-title" draggable="true">LAB6</div>'], ['<div class="class-title" draggable="true">JS</div>', '<div class="class-title" draggable="true">JS</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">JS</div>', '<div class="class-title" draggable="true">網站規劃</div>', '<div class="class-title" draggable="true">LAB7</div>'], ['<div class="class-title" draggable="true">JS</div>', '<div class="class-title" draggable="true">JS Advanced</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week6 = [['<div class="class-title" draggable="true">JS Advanced</div>', '<div class="class-title" draggable="true">JS Advanced</div>', '<div class="class-title" draggable="true">N/A</div>']];

        const week7 = [['<div class="class-title" draggable="true">JS Advanced</div>', '<div class="class-title" draggable="true">JS Advanced</div>', '<div class="class-title" draggable="true">LAB8</div>'], ['<div class="class-title" draggable="true">JS Advanced</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">MySQL</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">MySQL</div>', '<div class="class-title" draggable="true">MySQL</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week8 = [['<div class="class-title" draggable="true">MySQL</div>', '<div class="class-title" draggable="true">N/A</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">MySQL</div>', '<div class="class-title" draggable="true">MySQL</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week9 = [['<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">LAB9</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">LAB10</div>', '<div class="class-title" draggable="true">PHP</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week10 = [['<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">LAB11</div>'], ['<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">LAB12</div>'], ['<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">期中專題製作</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week11 = [['<div class="class-title" draggable="true">jQuery</div>', '<div class="class-title" draggable="true">jQuery</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">jQuery</div>', '<div class="class-title" draggable="true">jQuery</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">jQuery</div>', '<div class="class-title" draggable="true">jQuery</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">Plugin</div>', '<div class="class-title" draggable="true">Plugin</div>', '<div class="class-title" draggable="true">LAB13</div>']];

        const week12 = [['<div class="class-title" draggable="true">Plugin</div>', '<div class="class-title" draggable="true">Plugin</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">Plugin</div>', '<div class="class-title" draggable="true">Plugin</div>', '<div class="class-title" draggable="true">LAB14</div>'], ['<div class="class-title" draggable="true">Node.js</div>', '<div class="class-title" draggable="true">網站規劃</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">Node.js</div>', '<div class="class-title" draggable="true">Node.js</div>', '<div class="class-title" draggable="true">LAB15</div>'], ['<div class="class-title" draggable="true">Node.js</div>', '<div class="class-title" draggable="true">Node.js</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week13 = [['<div class="class-title" draggable="true">Node.js</div>', '<div class="class-title" draggable="true">職場講座</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">Node.js前後端</div>', '<div class="class-title" draggable="true">Node.js前後端</div>', '<div class="class-title" draggable="true">LAB16</div>'], ['<div class="class-title" draggable="true">Node.js前後端</div>', '<div class="class-title" draggable="true">Node.js前後端</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">Node.js前後端</div>', '<div class="class-title" draggable="true">Node.js前後端</div>', '<div class="class-title" draggable="true">LAB17</div>'], ['<div class="class-title" draggable="true">N/A</div>', '<div class="class-title" draggable="true">網站規劃</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week14 = [['<div class="class-title" draggable="true">HTML5 API</div>', '<div class="class-title" draggable="true">HTML5 API</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">HTML5 API</div>', '<div class="class-title" draggable="true">HTML5 API</div>', '<div class="class-title" draggable="true">LAB18</div>'], ['<div class="class-title" draggable="true">HTML5 API</div>', '<div class="class-title" draggable="true">HTML5 API</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">LAB19</div>'], ['<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">網站規劃</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week15 = [['<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">模擬面試</div>', '<div class="class-title" draggable="true">LAB20</div>'], ['<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">N/A</div>']];

        const week16 = [['<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">React.js</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">LAB21</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">LAB22</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week17 = [['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">LAB23</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">N/A</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week18 = [['<div class="class-title" draggable="true">N/A</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">LAB24</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>']];
        const week19 = [['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>']];

        const week20 = [['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">專題指導</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">專題預演</div>', '<div class="class-title" draggable="true">期末專題製作</div>', '<div class="class-title" draggable="true">N/A</div>'], ['<div class="class-title" draggable="true">專題發表</div>', '<div class="class-title" draggable="true">就業媒合活動</div>', '<div class="class-title" draggable="true">N/A</div>']];


        const allWeeks = [...week1, ...week2, ...week3, ...week4, ...week5, ...week6, ...week7, ...week8, ...week9, ...week10, ...week11, ...week12, ...week13, ...week14, ...week15, ...week16, ...week17, ...week18, ...week19, ...week20];


        const render = () => {
            root.innerHTML = '';
            dayIndex = 0;
            for (i = 1; i <= 12; i++) {
                month = i;
                weekIndex = 0;
                newMonthDiv = document.createElement('div');
                newMonthDiv.classList.add(`months`, `month-${month}`);

                let newMonthTitleArea = document.createElement('div');
                newMonthTitleArea.innerHTML = `${year}年 ${month}月`;
                newMonthDiv.append(newMonthTitleArea);

                let newWeekTitleArea = document.createElement('div');
                newWeekTitleArea.classList.add('weeks');
                for (let i = 0; i < 7; i++) {
                    let translateTitle = ['一', '二', '三', '四', '五', '六', '日']
                    let newWeekTitles = document.createElement('div');
                    newWeekTitles.classList.add('week-titles')
                    newWeekTitles.innerHTML = translateTitle[i];
                    newWeekTitleArea.append(newWeekTitles);
                }

                newMonthDiv.append(newWeekTitleArea);
                root.append(newMonthDiv);

                for (let i = 1; i <= dayjs(`${year}-${month}`).daysInMonth(); i++) {

                    if (i === 1 || dayjs(`${year}-${month}-${i}`).day() === 1) {
                        newWeekDiv = document.createElement('div');
                        newWeekDiv.classList.add(`weeks`, `week-${weekIndex}`);
                        if (i === 1) newWeekDiv.style.justifyContent = 'flex-end';
                        newMonthDiv.append(newWeekDiv);
                    }

                    let newDayDiv = document.createElement('div')
                    newDayDiv.innerHTML = i;
                    // newDayDiv.setAttribute("ondrop", "Drop(event)");
                    newDayDiv.setAttribute("ondragover", "AllowDrop(event)");
                    newDayDiv.className = 'days';

                    if (checkIfHoliday(`${year}-${month}-${i}`)) {
                        newDayDiv.classList.add('holiday');
                    }

                    if (dayjs(`${year}-${month}-${i}`).isSameOrAfter(dayjs(getDay.value)) && allWeeks[dayIndex] && dayjs(`${year}-${month}-${i}`).day() !== 6 && dayjs(`${year}-${month}-${i}`).day() !== 0 && !checkIfHoliday(`${year}-${month}-${i}`)) {
                        for (let k = 0; k < 3; k++) {
                            // console.log('hi', k, ',', week1[i - 1][k]);
                            console.log('hi1', allWeeks[dayIndex][k].split('div class'));
                            console.log('hi2', allWeeks[dayIndex][k].split('div class').join(`div id="classday${dayIndex}${k}" class`));
                            newDayDiv.innerHTML += allWeeks[dayIndex][k].split('div class').join(`div id="classday${dayIndex}${k}" ondragstart="Drag(event)" ondrop="Drop(event)" class`);
                        }
                        dayIndex++;
                    }

                    newWeekDiv.append(newDayDiv);

                    if (dayjs(`${year}-${month}-${i}`).day() === 1) {
                        weekIndex += 1;
                    }
                }
            }
        }

        render();

        function insertAfter(newNode, existingNode) {
            existingNode.parentNode.insertBefore(newNode, existingNode.nextSibling);
        }

        document.addEventListener('dragstart', (e) => {
            console.log(e.target);
            // Drag(e);
        })

        document.addEventListener('drop', (e) => {
            console.log('drop', e.target);
        })

        document.addEventListener('dragend', (e) => {
            console.log('dropend', e.target);
        })

        function AllowDrop(event) {
            event.preventDefault();
        }
        function Drag(event) {
            console.log('Drag evet', event);
            event.dataTransfer.setData("text", event.currentTarget.id);
        }
        function Drop(event) {
            console.log('drop event', event.currentTarget)
            event.preventDefault();
            var data = event.dataTransfer.getData("text");
            console.log('drop data', data)
            insertAfter(document.getElementById(data), event.currentTarget);
            // .appendChild();
        }



    </script>
</body>

</html>